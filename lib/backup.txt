import 'package:flutter/cupertino.dart';
import 'package:flutter/material.dart';

class MyMap extends StatefulWidget {
  @override
  _MyMapState createState() => _MyMapState();
}

class _MyMapState extends State<MyMap> {
  static const double _mapImageSize = 1000;
  Offset _offset = Offset.zero;

  @override
  Widget build(BuildContext context) {
    return LayoutBuilder(  // LayoutBuilder 추가
      builder: (context, constraints) {
        // Map위젯이 보일 크기
        final containerWidth = constraints.maxWidth;
        final containerHeight = constraints.maxHeight;

        return GestureDetector(
          onPanUpdate: (details) {
            setState(() {
              _offset += details.delta; // 드래그에 따라 offset을 업데이트

              // 이미지 드래그 범위 제한
              final double dxLimit = (_mapImageSize - containerWidth) / 2;
              final double dyLimit = (_mapImageSize - containerHeight) / 2;

              _offset = Offset(
                  _offset.dx.clamp(-dxLimit, dxLimit).toDouble(),
                  _offset.dy.clamp(-dyLimit, dyLimit).toDouble())
              ;
            });
          },
          child: Container(
            width: containerWidth,
            height: containerHeight,
            decoration: const BoxDecoration(
              shape: BoxShape.rectangle,
            ),
            clipBehavior: Clip.antiAlias, // 위젯 영역 밖은 그리지 않음
            child: OverflowBox( //하위 위젯의 크기가 보여지는 영역보다 크게 만들기 위함
              maxWidth: double.infinity,
              maxHeight: double.infinity,
              child: Stack( // 제일 밑에 지도 이미지를 깔고, 그 위에 여러 오브젝트를 올릴 예정
                children: [
                  Transform.translate(
                    offset: _offset,
                    child: Image.asset('assets/images/map.png', width: _mapImageSize, height: _mapImageSize),
                  ),
                  Positioned(
                    top: _mapImageSize/2 - 25,
                    left: _mapImageSize/2 - 25,
                    child: Transform.translate(
                      offset: _offset,
                      child: Container(
                        height: 50,
                        width: 50,
                        color: Colors.red,
                      ),
                    ),
                  )
                ],
              ),
            ),
          ),
        );
      },
    );
  }
}
